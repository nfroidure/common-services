[//]: # ( )
[//]: # (This file is automatically generated by the `jsarch`)
[//]: # (module. Do not change it elsewhere, changes would)
[//]: # (be overriden.)
[//]: # ( )
# Architecture Notes

## Summary

1. [Services](#1-services)
   1. [Logging](#11-logging)
   2. [Time](#12-time)
   3. [Randomness](#13-randomness)
   4. [Delaying](#14-delaying)
   5. [Process](#15-process)
      1. [Process name](#151-process-name)
      2. [Signals handling](#152-signals-handling)
      3. [Handling services fatal errors](#153-handling-services-fatal-errors)
      4. [Uncaught exceptions](#154-uncaught-exceptions)
   6. [Counter](#16-counter)
   7. [Code generator](#17-code-generator)
   8. [Lock](#18-lock)


## 1. Services

Since the services in this module are very common, we
 provide a helper to import them all with a single
 line of code.

Their goal is to encapsulate unpredictible states and
 inputs/outputs of the software they are part of. They
 are primarily meant to be used with
 [`knifecycle`](https://github.com/nfroidure/knifecycle)
 but should be usable with any DI system or even rawly.

[See in context](./src/index.ts#L1-L12)



### 1.1. Logging

I prefer using a unique function with the log type
 in parameter instead of several methods for each
 log types. It is far easyer to mock and to assert
 on logs in my tests.

If provided, I route debug messages to the `debug`
 node module.

[See in context](./src/log.ts#L53-L63)



### 1.2. Time

The time service is just proxying [`Date.now`
](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Date/now)
 in a stubbable manner.

[See in context](./src/time.ts#L12-L17)



### 1.3. Randomness

The random service is just proxying [`Math.random`
](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Math/random)
 in a stubbable manner.

[See in context](./src/random.ts#L12-L17)



### 1.4. Delaying

The delay service is `setTimeout` like I would like it
 to be.

[See in context](./src/delay.ts#L18-L22)



### 1.5. Process

The `process` service takes care of the process status.

It returns nothing and should be injected only for its
 side effects.

[See in context](./src/process.ts#L24-L29)



#### 1.5.1. Process name

It also set the process name with the actual NODE_ENV.

[See in context](./src/process.ts#L60-L63)



#### 1.5.2. Signals handling

It also handle SIGINT and SIGTERM signals to allow to
 gracefully shutdown the running process. The signals
 to handle can be customized by injecting the `SIGNALS`
 optional dependencies.

[See in context](./src/process.ts#L68-L74)



#### 1.5.3. Handling services fatal errors

If an error occurs it attempts to gracefully exit
to give it a chance to finish properly.

[See in context](./src/process.ts#L79-L83)



#### 1.5.4. Uncaught exceptions

If an uncaught exception occurs it also attempts to
 gracefully exit since a process should never be kept
 alive when an uncaught exception is raised.

[See in context](./src/process.ts#L90-L95)



### 1.6. Counter

The `counter` service provide a simple, local and
 stubbable counter.

The count are returned asynchronously in order
 to be easily maintained across several instances
 if needed later via another service with the same
 surface API.

[See in context](./src/counter.ts#L23-L32)



### 1.7. Code generator

The `codeGenerator` service provide a service
 that generate random strings composed of
 a character set that avoid recognition
 mistake by humans.

[See in context](./src/codeGenerator.ts#L20-L26)



### 1.8. Lock

This service allows to maintain a lock on a given resource in order
 to ensure a sequential access to it in asynchronous code.

The release is done by its key and the current lock is removed. There
 is no check on the fact the lock is well released. By design, it is
 your responsibility to ensure you release the locks properly. That
 said, it should not be hard to handle since the actual behavior of
 the library makes your code run sequentially.

[See in context](./src/lock.ts#L28-L38)

